INTERFACE CONTRACTS

1. Market Data:
   Type: Dict[str, pd.DataFrame]
   Required columns: ['timestamp','open','high','low','close','volume']
   If 'high' or 'low' missing:
     high = close * (1 + 0.001)
     low  = close * (1 - 0.001)
   Normalization:
     - Forward fill then drop remaining NaNs
     - Ascending by timestamp
   Minimum rows per symbol: 30

2. Strategy Output:
   generate_signals(market_data: Dict[str, pd.DataFrame]) -> List[Dict] (existing monolith)
   Each dict should minimally include:
     { 'symbol': str, 'action': 'BUY'|'SELL', 'price': float, 'strategy': str, optional 'confidence': float }
   ADAPTER will convert these to standardized DataFrame for scoring & persistence:
     ['timestamp','symbol','side','size','entry_price','stop_loss','take_profit','confidence','reason']
   If list empty for normal OHLCV noise, regeneration triggers.

3. Orchestrator:
   AlphaOrchestrator.get_consensus_signal(market_data) -> Dict:
     direction: int (-1,0,1)
     confidence: float (0..1)
     institutional_flow: float (0..1)
     reasoning: str
   No markdown fences, no example usage.

4. Backtester (local evaluation component for adaptive engine phase):
   run(market_data: Dict[str,pd.DataFrame], signals_df: pd.DataFrame) -> Dict metrics:
     total_trades, wins, losses, gross_pnl, net_pnl, avg_confidence, diversity, trade_ratio
   Must normalize market data as per section 1.

5. Alpha Scoring Formula:
   alpha = 0.35*diversity + 0.40*avg_confidence + 0.25*trade_ratio
   Base threshold = 0.45
   If cumulative (LOW_SIGNAL + INTERFACE_ERROR) >= 6 -> lower threshold temporarily to 0.40 until one viable iteration passes.

6. Diversity Gate:
   Pass if (signals >= 6) OR (>=2 symbols AND each >=3 signals)

7. Error Taxonomy Tags:
   SYNTAX_ERROR, INTERFACE_ERROR, LOW_SIGNAL, LOW_ALPHA, RUNTIME_FAIL, BACKTEST_FALLBACK, NORMALIZATION_WARN

8. Fallback:
   Orchestrator neutral (direction=0, confidence<0.1) -> strategy may emit technical fallback signals (still list-of-dicts, adapter handles DataFrame format).

9. Persistence:
   Save candidate signals (converted DataFrame) every iteration even on failure into:
     candidates/iteration_<n>_{viable|provisional|low_signal|interface_error|low_alpha}_signals.csv
   Append metrics + alpha in metrics_history.json.

10. Prohibited in generated files:
   - Markdown fences (```).
   - Example usage blocks in orchestrator/strategies.
   - Random synthetic fake OHLCV generation inside core trading logic (except your controlled testing utilities).
   - Removing AdaptiveTradingStrategy class.
